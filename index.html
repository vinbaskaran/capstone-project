<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõçÔ∏è Smart Product Recommendation System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            margin-top: 30px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sentiment-result {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        .sentiment-positive {
            border-left-color: #27ae60;
            background: #d5f4e6;
        }

        .sentiment-negative {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }

        .recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recommendation-card {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .product-name {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .product-category {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 15px;
        }

        .product-rating {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .stars {
            color: #f39c12;
            margin-right: 10px;
        }

        .product-reason {
            color: #7f8c8d;
            font-style: italic;
        }

        .error {
            background: #fdf2f2;
            color: #e74c3c;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #e74c3c;
            margin-top: 20px;
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                min-width: auto;
            }
            
            .recommendations {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è Smart Product Recommendation System</h1>
            <p>AI-Powered recommendations using Random Forest & Collaborative Filtering</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="userInput">Tell us what you're looking for or share your thoughts about a product:</label>
                    <textarea 
                        id="userInput" 
                        placeholder="Example: 'I need a good smartphone with great camera quality' or 'This laptop has amazing performance and battery life'"
                    ></textarea>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="getRecommendations()">
                        üîç Get Recommendations
                    </button>
                    <button class="btn-secondary" onclick="analyzeSentiment()">
                        üí≠ Analyze Sentiment Only
                    </button>
                </div>
            </div>

            <div id="results" class="results-section"></div>
        </div>

        <div class="footer">
            <p>üéì Capstone Project | Built with Random Forest (94.20% accuracy) + Collaborative Filtering</p>
        </div>
    </div>

    <script>
        function showLoading() {
            document.getElementById('results').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Processing your request...</p>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('results').innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                </div>
            `;
        }

        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '‚≠ê';
            }
            if (hasHalfStar) {
                stars += '‚≠ê';
            }
            
            return stars;
        }

        async function getRecommendations() {
            const userInput = document.getElementById('userInput').value.trim();
            
            if (!userInput) {
                showError('Please enter some text to get recommendations.');
                return;
            }

            showLoading();
            
            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: userInput,
                        n_recommendations: 5
                    })
                });

                const data = await response.json();

                if (data.status === 'error') {
                    showError(data.error || 'Failed to get recommendations');
                    return;
                }

                displayResults(data);

            } catch (error) {
                showError(`Network error: ${error.message}`);
            }
        }

        async function analyzeSentiment() {
            const userInput = document.getElementById('userInput').value.trim();
            
            if (!userInput) {
                showError('Please enter some text to analyze sentiment.');
                return;
            }

            showLoading();
            
            try {
                const response = await fetch('/api/sentiment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: userInput
                    })
                });

                const data = await response.json();

                if (data.status === 'error') {
                    showError(data.error || 'Failed to analyze sentiment');
                    return;
                }

                displaySentimentOnly(data);

            } catch (error) {
                showError(`Network error: ${error.message}`);
            }
        }

        function displaySentimentOnly(data) {
            const sentimentClass = data.sentiment === 'Positive' ? 'sentiment-positive' : 'sentiment-negative';
            const sentimentEmoji = data.sentiment === 'Positive' ? 'üòä' : 'üòû';
            
            document.getElementById('results').innerHTML = `
                <div class="sentiment-result ${sentimentClass}">
                    <h3>${sentimentEmoji} Sentiment Analysis Result</h3>
                    <p><strong>Sentiment:</strong> ${data.sentiment}</p>
                    <p><strong>Confidence:</strong> ${data.confidence}%</p>
                    <div style="margin-top: 15px;">
                        <small>
                            <strong>Detailed Probabilities:</strong><br>
                            Positive: ${data.probabilities.positive}% | 
                            Negative: ${data.probabilities.negative}%
                        </small>
                    </div>
                </div>
            `;
        }

        function displayResults(data) {
            const sentimentClass = data.sentiment_analysis.sentiment === 'Positive' ? 'sentiment-positive' : 'sentiment-negative';
            const sentimentEmoji = data.sentiment_analysis.sentiment === 'Positive' ? 'üòä' : 'üòû';
            
            let html = `
                <div class="sentiment-result ${sentimentClass}">
                    <h3>${sentimentEmoji} Sentiment Analysis</h3>
                    <p><strong>Sentiment:</strong> ${data.sentiment_analysis.sentiment}</p>
                    <p><strong>Confidence:</strong> ${data.sentiment_analysis.confidence}%</p>
                </div>
            `;

            if (data.recommendations && data.recommendations.length > 0) {
                html += `
                    <h3>üéØ Recommended Products for You</h3>
                    <div class="recommendations">
                `;

                data.recommendations.forEach(product => {
                    html += `
                        <div class="recommendation-card">
                            <div class="product-name">${product.product_name}</div>
                            <div class="product-category">${product.category}</div>
                            <div class="product-rating">
                                <span class="stars">${generateStars(product.predicted_rating)}</span>
                                <span>${product.predicted_rating}/5.0</span>
                            </div>
                            <div class="product-reason">${product.reason}</div>
                        </div>
                    `;
                });

                html += `</div>`;
            } else {
                html += `
                    <div class="error">
                        <p>No recommendations available at the moment. Please try a different query.</p>
                    </div>
                `;
            }

            document.getElementById('results').innerHTML = html;
        }

        // Add Enter key support for textarea
        document.getElementById('userInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                getRecommendations();
            }
        });

        // Example queries for demonstration
        const exampleQueries = [
            "I'm looking for a reliable smartphone with good camera quality",
            "Need a laptop for gaming and video editing",
            "This product has excellent build quality and fast shipping!",
            "Looking for kitchen appliances that are energy efficient",
            "The customer service was terrible and the product broke quickly"
        ];

        // Add a random example on page load
        window.addEventListener('load', function() {
            const randomExample = exampleQueries[Math.floor(Math.random() * exampleQueries.length)];
            document.getElementById('userInput').placeholder = `Example: "${randomExample}"`;
        });
    </script>
</body>
</html>